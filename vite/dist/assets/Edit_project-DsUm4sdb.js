import{r as a,u as ye,j as e,T as o,I as b,P as fe,B as _}from"./index-DjrlQ2F5.js";import{u as ve,T as l}from"./useAuth-DvVyDevX.js";import{C as Ce,S as z,A as $}from"./Snackbar-CFecR7nN.js";import{M as Se}from"./Menu-DE4PzJr1.js";import{T as be}from"./TableContainer-BbKF_kkm.js";import{T as we,a as Be,b as H,c as r,d as De,E as Te,D as Ae,e as R,f as J,g as X,h as q}from"./Edit-D7WWWgqQ.js";import{B as c}from"./OutlinedInput-DsoeenSI.js";import{M as G}from"./MenuItem-CowiRKKG.js";const Oe=()=>{const[d,h]=a.useState([]),[K,Q]=a.useState([]),[V,Y]=a.useState([]),[w,n]=a.useState(""),[B,u]=a.useState(""),[Z,D]=a.useState(!1),[ee,T]=a.useState(!1),[i,A]=a.useState(null),[W,P]=a.useState(null),[E,k]=a.useState(1),[U,We]=a.useState(20),[te,ae]=a.useState(!0),[p,I]=a.useState(""),[j,N]=a.useState(""),[x,F]=a.useState(""),[g,M]=a.useState(""),[m,O]=a.useState(""),[y,L]=a.useState(""),[se,oe]=a.useState(!1),[f,re]=a.useState("");ye();const{isAuthenticated:v,loading:ne}=ve();a.useEffect(()=>{v&&(le(),ie(),ce())},[v,E,f]);const le=async()=>{try{const t=await fetch(`https://ekarigar-accounts.onrender.com/projects?page=${E}&limit=${U}&search=${encodeURIComponent(f)}`);if(!t.ok)throw new Error("Failed to fetch projects");const s=await t.json();ae(s.length===U),h(me=>[...me,...s])}catch(t){n(t.message)}},ie=async()=>{try{const t=await fetch("https://ekarigar-accounts.onrender.com/projectcategories");if(!t.ok)throw new Error("Failed to fetch project categories");const s=await t.json();if(console.log("Fetched project categories:",s),Array.isArray(s))Q(s);else throw new Error("Project categories data is not an array")}catch(t){n(t.message)}},ce=async()=>{try{const t=await fetch("https://ekarigar-accounts.onrender.com/clients");if(!t.ok)throw new Error("Failed to fetch clients");const s=await t.json();if(console.log("Fetched client",s),Array.isArray(s))Y(s);else throw new Error("Client categories data is not an array")}catch(t){n(t.message)}},de=t=>{P(t),I(t.projectTitle),N(t.ServicedBy),F(t.SaledoneBy),M(t.ApprovedBy),O(t.projectCat),L(t.clientID),T(!0)},he=t=>{A(t),D(!0)},C=()=>{D(!1),A(null)},S=()=>{T(!1),P(null)},ue=t=>{re(t.target.value),k(1),h([])},pe=async()=>{try{if(!(await fetch(`https://ekarigar-accounts.onrender.com/projects/${i._id}`,{method:"DELETE"})).ok)throw new Error("Failed to delete project");u("Project deleted successfully"),h(d.filter(s=>s._id!==i._id)),C()}catch(t){console.error(t),n(t.message)}},je=async()=>{try{if(!(await fetch(`https://ekarigar-accounts.onrender.com/projects/${W._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectTitle:p,ServicedBy:j,SaledoneBy:x,ApprovedBy:g,projectCat:m,clientCat:y})})).ok)throw new Error("Failed to update project");u("Project updated successfully"),h(d.map(s=>s._id===W._id?{...s,projectTitle:p,ServicedBy:j,SaledoneBy:x,ApprovedBy:g,projectCat:m,clientCat:y}:s)),S()}catch(t){console.error(t),n(t.message)}},xe=()=>{k(t=>t+1)},ge=()=>{oe(!se)};return ne?e.jsx("div",{children:"Loading..."}):v?e.jsxs(Ce,{maxWidth:"md",children:[e.jsx(o,{variant:"h4",gutterBottom:!0,children:"Project List"}),e.jsxs(o,{variant:"h6",gutterBottom:!0,children:["Total Projects As per page: ",d.length]}),e.jsx(l,{label:"Search projects",variant:"outlined",fullWidth:!0,margin:"normal",value:f,onChange:ue,placeholder:"Search by project name"}),e.jsx(b,{edge:"start",color:"inherit","aria-label":"menu",onClick:ge,sx:{display:{xs:"block",sm:"none"}},children:e.jsx(Se,{})}),e.jsx(be,{component:fe,sx:{maxWidth:"100%",overflowX:"auto"},children:e.jsxs(we,{children:[e.jsx(Be,{children:e.jsxs(H,{children:[e.jsx(r,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Sr. No."})}),e.jsx(r,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Project Name"})}),e.jsx(r,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Service By"})}),e.jsx(r,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Sale Done By"})}),e.jsx(r,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Approved By"})}),e.jsx(r,{align:"right",children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold"},children:"Actions"})})]})}),e.jsx(De,{children:d.map((t,s)=>e.jsxs(H,{children:[e.jsx(r,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold"},children:s+1})}),e.jsx(r,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold"},children:t.projectTitle})}),e.jsx(r,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold"},children:t.ServicedBy})}),e.jsx(r,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold"},children:t.SaledoneBy})}),e.jsx(r,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold"},children:t.ApprovedBy})}),e.jsx(r,{align:"right",children:e.jsxs(_,{sx:{display:"flex",gap:1},children:[e.jsx(b,{color:"primary",onClick:()=>de(t),children:e.jsx(Te,{})}),e.jsx(b,{color:"secondary",onClick:()=>he(t),children:e.jsx(Ae,{})})]})})]},t._id))})]})}),te&&e.jsx(_,{textAlign:"right",mt:2,children:e.jsx(c,{variant:"outlined",color:"primary",size:"small",onClick:xe,sx:{transition:"all 0.3s ease","&:hover":{backgroundColor:"#003d99",color:"white",transform:"scale(1.05)"}},children:"Load More"})}),e.jsxs(R,{open:Z,onClose:C,children:[e.jsx(J,{children:"Confirm Deletion"}),e.jsxs(X,{children:['Are you sure you want to delete this "',i==null?void 0:i.projectTitle,'" project?']}),e.jsxs(q,{children:[e.jsx(c,{onClick:C,color:"primary",children:"Cancel"}),e.jsx(c,{onClick:pe,color:"secondary",children:"Delete"})]})]}),e.jsxs(R,{open:ee,onClose:S,children:[e.jsx(J,{children:"Update Project"}),e.jsxs(X,{children:[e.jsx(l,{margin:"dense",label:"Project Name",fullWidth:!0,value:p,onChange:t=>I(t.target.value)}),e.jsx(l,{margin:"dense",label:"Serviced By",fullWidth:!0,value:j,onChange:t=>N(t.target.value)}),e.jsx(l,{margin:"dense",label:"Sale Done By",fullWidth:!0,value:x,onChange:t=>F(t.target.value)}),e.jsx(l,{margin:"dense",label:"Approved By",fullWidth:!0,value:g,onChange:t=>M(t.target.value)}),e.jsx(l,{margin:"dense",label:"Project Category",select:!0,fullWidth:!0,value:m,onChange:t=>O(t.target.value),children:K.map(t=>e.jsx(G,{value:t.pcID,children:t.pcName},t.pcID))}),e.jsx(l,{margin:"dense",label:"Client",select:!0,fullWidth:!0,value:y,onChange:t=>L(t.target.value),children:V.map(t=>e.jsx(G,{value:t.clientID,children:t.clientName},t.clientID))})]}),e.jsxs(q,{children:[e.jsx(c,{onClick:S,color:"primary",children:"Cancel"}),e.jsx(c,{onClick:je,color:"secondary",children:"Update"})]})]}),e.jsx(z,{open:!!w,autoHideDuration:6e3,onClose:()=>n(""),children:e.jsx($,{onClose:()=>n(""),severity:"error",children:w})}),e.jsx(z,{open:!!B,autoHideDuration:6e3,onClose:()=>u(""),children:e.jsx($,{onClose:()=>u(""),severity:"success",children:B})})]}):null};export{Oe as default};
