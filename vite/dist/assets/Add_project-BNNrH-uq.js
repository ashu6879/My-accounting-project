import{r as n,u as W,j as e,T as E,F as g}from"./index-DjrlQ2F5.js";import{u as F,T as s,S as j}from"./useAuth-DvVyDevX.js";import{L}from"./LoadingButton-CeD71zW5.js";import{C as k,S as y,A as f}from"./Snackbar-CFecR7nN.js";import{I as v}from"./OutlinedInput-DsoeenSI.js";import{M as C}from"./MenuItem-CowiRKKG.js";import"./CircularProgress-BMgE6Vjs.js";const J=()=>{const[a,h]=n.useState({projectTitle:"",ServicedBy:"",SaledoneBy:"",ApprovedBy:"",ProgressBy:"",clientID:"",projectCat:""}),[x,S]=n.useState([]),[B,b]=n.useState([]),[c,i]=n.useState(""),[d,u]=n.useState(""),[D,m]=n.useState(!1),{isAuthenticated:w,loading:P}=F(),A=W();n.useEffect(()=>{(async()=>{try{const r=await fetch("https://ekarigar-accounts.onrender.com/clients");if(!r.ok)throw new Error("Failed to fetch clients");const l=await r.json();console.log("Fetched Clients:",l),S(l);const p=await fetch("https://ekarigar-accounts.onrender.com/projectcategories");if(!p.ok)throw new Error("Failed to fetch categories");const T=await p.json();b(T)}catch(r){i(r.message)}})()},[]);const o=t=>{console.log("Changing:",t.target.name,t.target.value),h({...a,[t.target.name]:t.target.value})},I=async t=>{t.preventDefault(),m(!0),console.log("Submitting Project Data:",a);try{const r=await fetch("https://ekarigar-accounts.onrender.com/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const l=await r.text();throw new Error(l||"Failed to add project")}u("Project added successfully!"),h({projectTitle:"",ServicedBy:"",SaledoneBy:"",ApprovedBy:"",ProgressBy:"",clientID:"",projectCat:""}),setTimeout(()=>{A("/ManageProject/edit")},2e3)}catch(r){i(r.message)}finally{m(!1)}};return P?e.jsx("div",{children:"Loading..."}):w?e.jsxs(k,{maxWidth:"sm",children:[e.jsx(E,{variant:"h4",gutterBottom:!0,children:"Add Project"}),e.jsxs("form",{onSubmit:I,children:[e.jsx(s,{label:"Project Title",name:"projectTitle",variant:"outlined",fullWidth:!0,value:a.projectTitle,onChange:o,margin:"normal",required:!0}),e.jsx(s,{label:"Serviced By",name:"ServicedBy",variant:"outlined",fullWidth:!0,value:a.ServicedBy,onChange:o,margin:"normal",required:!0}),e.jsx(s,{label:"Sale Done By",name:"SaledoneBy",variant:"outlined",fullWidth:!0,value:a.SaledoneBy,onChange:o,margin:"normal"}),e.jsx(s,{label:"Approved By",name:"ApprovedBy",variant:"outlined",fullWidth:!0,value:a.ApprovedBy,onChange:o,margin:"normal"}),e.jsx(s,{label:"Progress By",name:"ProgressBy",variant:"outlined",fullWidth:!0,value:a.ProgressBy,onChange:o,margin:"normal"}),e.jsxs(g,{variant:"outlined",fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(v,{id:"client-label",children:"Client"}),e.jsx(j,{labelId:"client-label",id:"clientID",name:"clientID",value:a.clientID,onChange:o,label:"Client",children:x.map(t=>e.jsx(C,{value:t.clientID,children:t.clientName},t.clientID))})]}),e.jsxs(g,{variant:"outlined",fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(v,{id:"category-label",children:"Project Category"}),e.jsx(j,{labelId:"category-label",id:"projectCat",name:"projectCat",value:a.projectCat,onChange:o,label:"Project Category",children:B.map(t=>e.jsx(C,{value:t.pcID,children:t.pcName},t.pcID))})]}),e.jsx(L,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,loading:D,children:"Add Project"})]}),d&&e.jsx(y,{open:!!d,autoHideDuration:6e3,onClose:()=>u(""),children:e.jsx(f,{onClose:()=>u(""),severity:"success",sx:{width:"100%"},children:d})}),c&&e.jsx(y,{open:!!c,autoHideDuration:6e3,onClose:()=>i(""),children:e.jsx(f,{onClose:()=>i(""),severity:"error",sx:{width:"100%"},children:c})})]}):null};export{J as default};
