import{r as s,u as Y,j as e,T as o,I as k,B as Z}from"./index-DjrlQ2F5.js";import{u as ee,T as N}from"./useAuth-DvVyDevX.js";import{C as te,S as U,A as W}from"./Snackbar-CFecR7nN.js";import{T as se,a as ae,b as z,c as n,d as oe,E as ne,D as re,e as A,f as B,g as L,h as _}from"./Edit-D7WWWgqQ.js";import{B as l}from"./OutlinedInput-DsoeenSI.js";import{D as O}from"./DialogContentText-qY3U4X4o.js";const me=()=>{const[c,d]=s.useState([]),[j,r]=s.useState(""),[C,h]=s.useState(""),[F,f]=s.useState(!1),[$,y]=s.useState(!1),[i,S]=s.useState(null),[D,b]=s.useState(null),[T,w]=s.useState(1),[v,ie]=s.useState(20),[H,M]=s.useState(!0),[u,E]=s.useState(""),[x,I]=s.useState("");Y();const{isAuthenticated:m,loading:P}=ee();s.useEffect(()=>{m&&R()},[T,m,x]);const R=async()=>{try{const t=await fetch(`https://ekarigar-accounts.onrender.com/clientcategories?page=${T}&limit=${v}&search=${x}`);if(!t.ok)throw new Error("Failed to fetch clients");const a=await t.json();M(a.length===v),d(X=>[...X,...a])}catch(t){r(t.message)}},J=t=>{b(t),E(t.ccName),y(!0)},q=t=>{S(t),f(!0)},p=()=>{f(!1),S(null)},g=()=>{y(!1),b(null)},G=async()=>{try{if(!(await fetch(`https://ekarigar-accounts.onrender.com/clientcategories/${i._id}`,{method:"DELETE"})).ok)throw new Error("Failed to delete client");h("Category deleted successfully"),d(c.filter(a=>a._id!==i._id)),p()}catch(t){r(t.message)}},K=async()=>{try{if(!(await fetch(`https://ekarigar-accounts.onrender.com/clientcategories/${D._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({ccName:u})})).ok)throw new Error("Failed to update client");h("Category updated successfully"),d(c.map(a=>a._id===D._id?{...a,ccName:u}:a)),g()}catch(t){r(t.message)}},Q=()=>{w(t=>t+1)},V=t=>{I(t.target.value),w(1),d([])};return P?e.jsx("div",{children:"Loading..."}):m?e.jsxs(te,{maxWidth:"md",children:[e.jsx(o,{variant:"h4",gutterBottom:!0,children:"Category List"}),e.jsx(N,{label:"Search Client Categories",variant:"outlined",fullWidth:!0,value:x,onChange:V,sx:{mb:2}}),e.jsxs(o,{variant:"h6",gutterBottom:!0,children:["Total Clients As per page: ",c.length]}),e.jsxs(se,{children:[e.jsx(ae,{children:e.jsxs(z,{children:[e.jsx(n,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Sr. No."})}),e.jsx(n,{children:e.jsx(o,{variant:"h6",sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Client Name"})}),e.jsx(n,{align:"right",sx:{fontWeight:"bold",fontSize:"1.2rem"},children:"Actions"})]})}),e.jsx(oe,{children:c.map((t,a)=>e.jsxs(z,{children:[e.jsx(n,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1rem"},children:a+1})}),e.jsx(n,{children:e.jsx(o,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1rem"},children:t.ccName})}),e.jsxs(n,{align:"right",children:[e.jsx(k,{color:"primary",onClick:()=>J(t),children:e.jsx(ne,{})}),e.jsx(k,{color:"secondary",onClick:()=>q(t),children:e.jsx(re,{})})]})]},t._id))})]}),H&&e.jsx(Z,{textAlign:"right",mt:2,children:e.jsx(l,{variant:"outlined",color:"primary",size:"small",onClick:Q,sx:{transition:"all 0.3s ease","&:hover":{backgroundColor:"#003d99",color:"white",transform:"scale(1.05)",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.2)"}},children:"Load More"})}),e.jsxs(A,{open:F,onClose:p,children:[e.jsx(B,{children:"Delete Client"}),e.jsx(L,{children:e.jsxs(O,{children:['Are you sure you want to delete the client "',i==null?void 0:i.ccName,'"?']})}),e.jsxs(_,{children:[e.jsx(l,{onClick:p,color:"primary",children:"Cancel"}),e.jsx(l,{onClick:G,color:"secondary",children:"Delete"})]})]}),e.jsxs(A,{open:$,onClose:g,fullWidth:!0,maxWidth:"sm",children:[e.jsx(B,{children:"Update Client Category"}),e.jsxs(L,{children:[e.jsx(O,{children:"Update the client Category name:"}),e.jsx(N,{autoFocus:!0,margin:"dense",id:"name",label:"Client Name",type:"text",fullWidth:!0,variant:"outlined",value:u,onChange:t=>E(t.target.value),sx:{mt:2}})]}),e.jsxs(_,{children:[e.jsx(l,{onClick:g,color:"primary",children:"Cancel"}),e.jsx(l,{onClick:K,color:"secondary",children:"Update"})]})]}),e.jsx(U,{open:!!C,autoHideDuration:6e3,onClose:()=>h(""),children:e.jsx(W,{onClose:()=>h(""),severity:"success",sx:{width:"100%"},children:C})}),e.jsx(U,{open:!!j,autoHideDuration:6e3,onClose:()=>r(""),children:e.jsx(W,{onClose:()=>r(""),severity:"error",sx:{width:"100%"},children:j})})]}):null};export{me as default};
