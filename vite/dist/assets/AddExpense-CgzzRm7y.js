import{r as o,u as L,j as e,T as q,G as r,F as z,B as y}from"./index-DjrlQ2F5.js";import{u as G,S as H,T as v}from"./useAuth-DvVyDevX.js";import{d as M}from"./Delete-BND5BdWY.js";import{C as N,S as D,A as S}from"./Snackbar-CFecR7nN.js";import{I as O,B as h}from"./OutlinedInput-DsoeenSI.js";import{M as _}from"./MenuItem-CowiRKKG.js";const X=()=>{const[C,E]=o.useState([]),[l,c]=o.useState([{description:"",amount:0}]),[u,j]=o.useState({projectID:"",description:"",amount:0}),[x,d]=o.useState(!1),[f,i]=o.useState(""),[I,p]=o.useState(""),{isAuthenticated:b,loading:A}=G(),w=L();o.useEffect(()=>{P()},[]);const P=async()=>{try{const s=await(await fetch("https://ekarigar-accounts.onrender.com/projects")).json();E(s)}catch{i("Failed to fetch projects")}},T=t=>{const s=t.target.value;j(n=>({...n,projectID:s}))},g=(t,s)=>{const{name:n,value:a}=s.target;c(k=>{const m=[...k];return m[t]={...m[t],[n]:a},m})},B=()=>{c(t=>[...t,{description:"",amount:0}])},F=t=>{c(s=>s.filter((n,a)=>a!==t))},W=async t=>{if(t.preventDefault(),d(!0),!u.projectID||l.some(s=>!s.description||s.amount<=0)){i("Please fill out all required fields."),d(!1);return}try{const s=await Promise.all(l.map(async n=>{const a=await fetch("https://ekarigar-accounts.onrender.com/Expense",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectID:u.projectID,description:n.description,amount:n.amount})});if(!a.ok)throw new Error("Failed to add expense item");return a.json()}));p("Expense items added successfully!"),j({projectID:"",description:"",amount:""}),c([{description:"",amount:0}]),setTimeout(()=>{w("/ProjectExpense/edit")},2e3)}catch(s){i(s.message)}finally{d(!1)}};return A?e.jsx("div",{children:"Loading..."}):b?e.jsxs(N,{maxWidth:"md",children:[e.jsx(q,{variant:"h4",gutterBottom:!0,children:"Add Expense"}),e.jsx("form",{onSubmit:W,children:e.jsxs(r,{container:!0,spacing:3,children:[e.jsx(r,{item:!0,xs:12,sm:6,children:e.jsxs(z,{variant:"outlined",fullWidth:!0,required:!0,children:[e.jsx(O,{id:"project-label",children:"Select Project"}),e.jsx(H,{labelId:"project-label",id:"projectID",name:"projectID",value:u.projectID,onChange:T,label:"Select Project",children:C.map(t=>e.jsx(_,{value:t.projectID,children:t.projectTitle},t.projectID))})]})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(h,{variant:"outlined",color:"primary",onClick:B,children:"Add Item"}),l.map((t,s)=>e.jsx(y,{mt:2,children:e.jsxs(r,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(r,{item:!0,xs:12,sm:8,children:e.jsx(v,{label:"Description",name:"description",variant:"outlined",fullWidth:!0,value:t.description,onChange:n=>g(s,n)})}),e.jsx(r,{item:!0,xs:12,sm:2,children:e.jsx(v,{type:"numeric",label:"Amount",name:"amount",variant:"outlined",fullWidth:!0,value:t.amount,onChange:n=>g(s,n)})}),e.jsx(r,{item:!0,xs:12,sm:2,children:e.jsx(y,{display:"flex",justifyContent:"center",children:e.jsx(h,{variant:"outlined",color:"secondary",onClick:()=>F(s),startIcon:e.jsx(M,{})})})})]})},s))]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(h,{variant:"contained",color:"primary",type:"submit",fullWidth:!0,disabled:x,children:x?"Adding Expense...":"Add Expense"})})]})}),I&&e.jsx(D,{open:!0,autoHideDuration:6e3,onClose:()=>p(""),children:e.jsx(S,{onClose:()=>p(""),severity:"success",children:I})}),f&&e.jsx(D,{open:!0,autoHideDuration:6e3,onClose:()=>i(""),children:e.jsx(S,{onClose:()=>i(""),severity:"error",children:f})})]}):null};export{X as default};
