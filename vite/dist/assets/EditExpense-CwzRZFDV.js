import{j as e,B as i,r as o,T as r,P as se,I as B}from"./index-DjrlQ2F5.js";import{u as ne,T as L}from"./useAuth-DvVyDevX.js";import{C as oe}from"./CircularProgress-BMgE6Vjs.js";import{C as ae,S as F,A as O}from"./Snackbar-CFecR7nN.js";import{T as re}from"./TableContainer-BbKF_kkm.js";import{T as le,a as ce,b as R,c,d as ie,E as de,D as pe,e as z,f as H,g as N,h as _}from"./Edit-D7WWWgqQ.js";import{B as j}from"./OutlinedInput-DsoeenSI.js";const he=({size:C=40,message:u="Loading..."})=>e.jsxs(i,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column",children:[e.jsx(oe,{size:C}),e.jsx(i,{mt:2,children:u})]}),ye=()=>{const[C,u]=o.useState([]),[E,b]=o.useState([]),[m,f]=o.useState([]),[T,d]=o.useState(""),[P,h]=o.useState(""),[$,w]=o.useState(!1),[q,I]=o.useState(null),[x,S]=o.useState([]),[J,g]=o.useState(!1),[a,D]=o.useState(null),[X,v]=o.useState(!0),{isAuthenticated:G,loading:K}=ne();o.useEffect(()=>{M()},[]);const M=o.useCallback(async()=>{v(!0);try{const t=await fetch("http://ec2-13-234-31-37.ap-south-1.compute.amazonaws.com:8181/expense");if(!t.ok)throw new Error("Failed to fetch expenses");const s=await t.json();b(s);const n=Array.from(new Set(s.map(l=>l.projectID))),p=await fetch("http://ec2-13-234-31-37.ap-south-1.compute.amazonaws.com:8181/projects");if(!p.ok)throw new Error("Failed to fetch projects");const U=(await p.json()).filter(l=>n.includes(l.projectID));u(U);const ee=U.map(l=>({...l,expenses:s.filter(te=>te.projectID===l.projectID)}));f(ee)}catch(t){d(t.message)}finally{v(!1)}},[]),Q=t=>{I(t),S(t.expenses),w(!0)},y=()=>{w(!1),I(null)},V=async()=>{try{const t=x.map(s=>fetch(`http://ec2-13-234-31-37.ap-south-1.compute.amazonaws.com:8181/Expense/${s._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}));await Promise.all(t),h("Expenses updated successfully"),f(m.map(s=>s.projectID===q.projectID?{...s,expenses:x}:s)),y()}catch(t){d(t.message)}},A=(t,s,n)=>{S(x.map((p,k)=>k===t?{...p,[s]:n}:p))},Y=t=>{D(t),g(!0)},Z=async()=>{if(a)try{const s=E.filter(n=>n.projectID===a.projectID).map(n=>fetch(`http://ec2-13-234-31-37.ap-south-1.compute.amazonaws.com:8181/Expense/${n._id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}));await Promise.all(s),h("Expenses deleted successfully"),b(E.filter(n=>n.projectID!==a.projectID)),f(m.filter(n=>n.projectID!==a.projectID))}catch(t){d(t.message)}finally{g(!1),D(null)}},W=()=>{g(!1),D(null)};return K?e.jsx("div",{children:"Loading..."}):G?e.jsx(ae,{maxWidth:"md",children:X?e.jsx(he,{}):e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"h4",gutterBottom:!0,children:"Edit Project Expenses"}),e.jsx(re,{component:se,sx:{maxWidth:"100%",overflowX:"auto"},children:e.jsxs(le,{children:[e.jsx(ce,{children:e.jsxs(R,{children:[e.jsx(c,{children:e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:"Project Name"})}),e.jsx(c,{children:e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},children:"Expense Details"})}),e.jsx(c,{align:"right",children:e.jsx(r,{variant:"h6",sx:{fontWeight:"bold"},textAlign:"center",children:"Action"})})]})}),e.jsx(ie,{children:m.map(t=>e.jsxs(R,{children:[e.jsx(c,{children:e.jsx(r,{variant:"body1",sx:{fontWeight:"bold"},children:t.projectTitle})}),e.jsx(c,{children:e.jsx(i,{children:t.expenses.map((s,n)=>e.jsx(i,{mb:1,children:e.jsxs(r,{variant:"body1",sx:{fontWeight:"bold"},children:[s.description||"","-",s.amount||0]})},n))})}),e.jsx(c,{align:"right",children:e.jsxs(i,{sx:{display:"flex",gap:1},justifyContent:"center",children:[e.jsx(B,{color:"primary",onClick:()=>Q(t),children:e.jsx(de,{})}),e.jsx(B,{color:"secondary",onClick:()=>Y(t),children:e.jsx(pe,{})})]})})]},t.projectID))})]})}),e.jsxs(z,{open:$,onClose:y,fullWidth:!0,maxWidth:"md",children:[e.jsx(H,{children:"Update Project Expenses"}),e.jsx(N,{children:x.map((t,s)=>e.jsxs(i,{mb:2,sx:{display:"flex",gap:2},children:[e.jsx(L,{margin:"dense",label:"Description",fullWidth:!0,value:t.description||"",onChange:n=>A(s,"description",n.target.value)}),e.jsx(L,{margin:"dense",label:"Amount",fullWidth:!0,type:"number",value:t.amount||"",onChange:n=>A(s,"amount",n.target.value)})]},s))}),e.jsxs(_,{children:[e.jsx(j,{onClick:y,color:"primary",children:"Cancel"}),e.jsx(j,{onClick:V,color:"secondary",children:"Update"})]})]}),e.jsxs(z,{open:J,onClose:W,children:[e.jsx(H,{children:"Confirm Deletion"}),e.jsx(N,{children:e.jsxs(r,{children:["Are you sure you want to delete expenses for the project: ",e.jsx("strong",{children:a==null?void 0:a.projectTitle}),"?"]})}),e.jsxs(_,{children:[e.jsx(j,{onClick:W,color:"primary",children:"Cancel"}),e.jsx(j,{onClick:Z,color:"secondary",children:"Delete"})]})]}),e.jsx(F,{open:!!T,autoHideDuration:6e3,onClose:()=>d(""),children:e.jsx(O,{onClose:()=>d(""),severity:"error",children:T})}),e.jsx(F,{open:!!P,autoHideDuration:6e3,onClose:()=>h(""),children:e.jsx(O,{onClose:()=>h(""),severity:"success",children:P})})]})}):null};export{ye as default};
